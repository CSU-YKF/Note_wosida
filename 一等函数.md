# 一等函数

Python中的函数是一等对象,也因此习惯将Python的函数称为一等函数, 实际上, 整数,字符串和字典都是一等对象.一等对象意味着它们都是某个类的实例.

另外, 一等对象是函数式语言的特性, 虽然Python是面向对象的语言, 但是它完全可以当作函数式语言来使用.

## 面向对象与函数式

面向对象意味着程序中充斥着的都是类和类的对象, 我们在进行编程和API调用时, 只需要关注类和对象, 拿PyTorch来举例, Tensor是一个类, 我们日常使用的API有`Tensor.sum()`, sum()是Tensor类下的一个方法, 同时也是Torch类下的一个函数, 即同样可以调用`sum(Tensor)`, 来对Tensor进行求和, 效果和调用方法一样, 这就是面向对象和函数式语言的编程时的区别.下面我们通过详细介绍Python中的一等函数来理解.

## 函数即对象

我们每次使用字段`def`来定义一个函数,实际上都是声明了`function`类的一个实例,而Python解释器会在每次调用这个函数时来为这个实例开辟内存.

```Python
def add(x, y):
	return x + y
```

这里的`add`就是`function`类的实例,只有当我们调用`add(1, 1)`时,才会创建它,这是一等函数的第一个特性:**运行时才创建**.

同样,我们也可以调用`add(1, add(1, 1))`来实现1+1+1,这里我们把一个函数作为参数传给了另一个函数,也是很容易理解的,因为函数是一个对象,所以可以作为参数赋值[^变量引用].这是一等函数的第二个特性:**可以作为参数赋值**.

[^变量引用]:赋值在这里的说法并不准确,Python中的`=`更像是贴标签.

接受函数作为参数或者返回值为函数的函数,称为高阶函数,这是函数式语言的定义,我们这里只是为了介绍Python的一等函数特性,不再过多解释函数式语言编写的方式.

## 匿名函数

`lambda`关键字来创建一个匿名函数.

匿名函数的主体只能是纯粹的表达式, 即不能有`while`,`try`等语句. 注意, 赋值`=`也是一种语句, 但是可以有`:=`赋值表达式.

匿名函数可以用于高阶函数之中来减少代码量, 但是一定注意不要滥用匿名函数, 因为它一旦复杂起来可读性就会很差. 一般来说, 当你的匿名函数中不得不出现`:=`等类似表达式的时候, 就表示它比较复杂了, 需要进行重构, 改成使用`def`定义的常规函数.

## 可调用对象

Python中调用运算符`( )`是指对象的调用, 一般对象不可调用, Python有9种可调用的对象.

1. 使用`def`定义的函数
2. 内置函数如`len`等
3. 内置方法如`dict.get`
4. 方法, 即在类主体内定义的函数
5. 类, 调用类时候首先运行类的`__new__`方法来开辟内存创建实例, 然后运行`__init__`方法来进行实例初始化, 最后再把变量标注到实例上. 注意, Python中没有`new`运算符, 调用类就相当于调用函数.
6. 类的实例, 如果类定义了`__call__`方法, 其实例可以作为函数调用, 调用时候运行`__call__`.
7. 生成器函数, 函数主体内含有`yield`关键字, 返回一个生成器对象, 注: 生成器属于Python的高级编程.
8. 原生协程函数, 使用`async def`定义的函数或方法. 返回一个携程对象. 同样是高级编程.
9. 异步生成器函数, 即使用`async def`定义, 且主体内含有`yield`的函数, 返回一个异步生成器.

## 参数设置

### 仅限关键字参数

可以设置函数的一些参数只能通过关键字来调用.

```python
def time(*date, hour=None, min=None):
	return f"{*data} {hour} {min}"
```

这里`hour`和`min`只能通过关键字来进行调用, 否则都被`date`拆包捕获.

类似也可以设置`**date`.

### 仅限位置参数

这是Python3.8新增的特性.

```python
def divmod(a, b, /):
	return (a // b, a % b)
```

这时候`a`和`b`都不能通过关键字来进行调用, 关键在于`/`, 其左侧均为仅限位置参数, 右侧正常.